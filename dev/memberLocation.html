<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>


    <!-- css -->
    @@loop('template/csslink.html',[
    {"csslink" : "css/style.css"}
    ])

    <!-- <link rel="stylesheet" href="css/memberCenter.css"> -->

</head>

<body class="memberLocation_page">
    <header class="header_navbar">
        @@include("template/header.html")
    </header>
    <!-- ------會員中心部分------ -->
    <section class="account">
        <div class="infowrap tabs">
            <!-- ----------------選單部分--------------- -->
            <div class="menulist tab-demo tab-links">
                <!-- 選單部分 -->
                <ul class="mymenu tab-title tab-list">
                    <li>
                        <a href="#tab01">我的資料</a>
                    </li>
                    <li>
                        <a href="#tab02">訂單紀錄</a>
                    </li>
                    <li>
                        <a href="#tab03">組隊紀錄</a>
                    </li>
                    <li>
                        <a href="#tab04">購票紀錄</a>
                    </li>
                    <li>
                        <a href="#tab05">留言紀錄</a>
                    </li>
                    <li>
                        <a href="javascript:void(0)" class="tablink">登出</a>
                    </li>
                </ul>
            </div>
            <!-- -------------個人資訊部分--------------- -->
            <div class="info_content tab-inner active" id="tab01">
                <!-- 文字檔案部分 -->
                <form id="content_form ">
                    <!-- 個人資料區 -->
                    <h3>我的資料</h3>
                    <!-- 帳號 -->
                    <div class="content_item">
                        <span>帳號</span>
                        <span class="memid" id="memid"></span>
                    </div>
                    <!-- 姓名 -->
                    <div class="content_item">
                        <span>姓名</span>
                        <input type="text" id="mem_name" placeholder="請輸入名字" name="mem_name" required="required">
                    </div>
                    <!-- 信箱 -->
                    <div class="content_item">
                        <span>信箱</span>
                        <input type="email" id="mem_email" placeholder="1111@11.com" name="mem_email"
                            required="required">
                    </div>
                    <!-- 電話 -->
                    <div class="content_item">
                        <span>電話</span>
                        <input type="tel" id="mem_phone" placeholder="請輸入電話" name="mem_phone" required="required">
                    </div>
                    <!-- 生日-->
                    <div class="content_item">
                        <span>生日</span>
                        <input type="date" id="mem_birth" name="mem_birth" placeholder="e.g. 1999-01-01"
                            required="required">
                    </div>
                    <!-- 信用卡區  -->
                    <h3>我的信用卡</h3>
                    <div class="content_item">
                        <span>信用卡</span>
                        <input type="text" id="mem_credit" placeholder="0000-0000-0000-0000" name="mem_credit">
                    </div>
                    <!-- 購物金區  -->
                    <h3>我的購物金</h3>
                    <div class="content_item">
                        <span>購物金</span>
                        <span class="memdoller" id="member_money"></span>
                    </div>
                    <!-- 修改資料按鈕 -->
                    <div class="content_item but_item">
                        <!-- <a class=" diti_button"> -->
                        <input type="submit" name="button" class="btn" id="dit_button" value="修改資料" />
                        <!-- </a> -->

                    </div>
                </form>
            </div>
            <!-- -----------------訂單部分 ----------------->
            <div id="tab02" class="order_content tab-inner">
                <div class="order_list" id="order_list">
                    <h3>我的訂單</h3>
                    <div class="order_item" id="order_item">
                        <table>
                            <tr>
                                <td class="title">訂單日期</td>
                                <td class="title">訂單編號</td>
                                <td class="title">訂單狀況</td>
                                <td class="title">訂單金額</td>
                            </tr>
                            <tr>
                                <td>2019/08/23</td>
                                <td>no123</td>
                                <td>出貨中</td>
                                <td>$2100</td>
                            </tr>
                        </table>
                        <h4>訂單詳情</h4>
                        <form class="bt" style="">
                                <div class="bg_fdfff3">
                                    <div class="shopping_cart  m40_0_0  dis_f_jc_c">
                                        <div class="col48 m-a col-lg-3 dis_f_jc_c shopping_cart_item bl">
                                            <div class="po-r w-50p m-a">
                                                <img class="shoppingCartContentImg" src="">
                                                <input type="hidden" name="pImage" value="towel4.png">
                                            </div>
                                        </div>
                                        <div class="col48 col-lg-3 dis_f_jc_c shopping_cart_item bl">
                                            <p class="shoppingCartContentPdName"></p>
                                            <input type="hidden" name="pName" value="仙人掌-紅色">
                                            <p class="dis-lg-n">單價：$<span class="thePrice dis-lg-n"></span></p>
                                            
                                        </div>
                                        <div class="dis_n col-lg-2 dis_f_jc_c shopping_cart_item bl">
                                            <p>$<span class="thePrice"></span></p>
                                            <input type="hidden" name="pPrice" value="299">
                                        </div>
                                        <div class="col48 col-lg-2 dis_f_jc_c shopping_cart_item bl">
                                            <div class="dis_f_jc_c ai-fs">
                
                                                <input type="submit" value="1" name="pQuantity" class="quantity"
                                                    style="background-color: transparent;border: transparent;font-size: 16px">
                
                                            </div>
                                        </div>
                                        <div class="col48 col-lg-2 dis_f_jc_c shopping_cart_item bl">
                                            <p>NT.<span class="thePrice subtotal">0</span></p>
                                            <input type="hidden" name="pPrice" value="299">
                                        </div>
                                        
                                        
                                    </div>
                                </div>
                            </form>
                    </div>
                </div>
            </div>
            <!-- ---------購票部分 -------------------->
            <div id="tab04" class="ticket_content tab-inner">
                <div class="ticket_list" id="ticket_list">
                    <h3>我的門票</h3>
                    <!-- <div class="ticket_item"> -->
                    <!-- <p>門票編號:<span id="ticket_no"></span></p>
                        <p>門票使用狀態:<span id="entrance_status"></span></p> -->
                    <!-- <table>
                            <tr>
                                <td>購票日期</td>
                                <td>門票編號</td>
                                <td>門票狀況</td>
                                <td>門票金額</td>
                            </tr>
                            <tr>
                                <td>2019/08/23</td>
                                <td>no123</td>
                                <td>已使用</td>
                                <td>$600</td>
                            </tr>
                        </table> -->
                    <!-- </div> -->
                </div>
            </div>
            <!-- ---------組隊部分 ------------------->
            <div id="tab03" class="team_content tab-inner">
                <div class="team_list" id="team_list">
                        <h3 >歷史紀錄</h3>
                
                    <div class="team_item">
                        <table>
                            <tr class="team_head">
                                <td>隊伍編號</td>
                                <td>隊伍名稱</td>
                                <td>隊伍人數</td>
                                <td>懸賞金</td>
                            </tr>
                            <!-- <tr class="team_body">
                                <td id="team_no"></td>
                                <td id="team_name"></td>
                                <td id="team_num"></td>
                                <td id="team_bounty"></td>
                            </tr> -->
                        </table>
                    </div>
                </div>
            </div>
            <!-- -------------評分/留言部分 ----------------->
            <div id="tab05" class="evaluation_content tab-inner">
                <div class="evaluation_list" id="evaluation_list">
                    <!-- <h3>我的評分</h3>
                    <div class="score_box">
                        
                        <div class="score_item">
                            <div class="equ_historypic">
                                <span>海盜船</span>
                                
                            </div>
                            <div class="equ_score">
                                <span>評分</span>
                                <span>3</span>
                            </div>
                        </div>
                    </div> -->
                    <h3>我的留言</h3>
                    <div class="message_box">
                        <!-- 第ㄧ則留言 -->
                        <div class="message_item">
                            <div class="message_pot">
                                <div class="equ_historypic">
                                    <!-- <img src="" alt="設施照片"> -->
                                    <span>設施</span>
                                    <span class="equ_no">雲霄飛車</span>
                                </div>
                                <div class="equ_message">
                                    <p class="equ_message_txt">約朋友一起去好久沒去的遊樂園，但好笑的是我和我的朋友們其實都不太敢坐那種超可怕的遊樂設施哈哈哈哈</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- <script src="js/memberTab.js"></script> -->
    @@include("template/footer.html")

    <!-- js -->

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    <script>
        // <!------ tab open page ----->

        $(function () {

            // Show tab click event
            const showTab = (event) => {
                event.preventDefault();

                // Get tabs and content
                const tabs = document.querySelectorAll('.tabs .active');

                // Remove active class from items
                tabs.forEach(tab => {
                    tab.classList.remove('active');
                });

                // Add active class to clicked item
                event.target.parentElement.classList.add('active');
                document.getElementById(event.target.href.split('#')[1]).classList.add('active');
            }

            // Add event listener to all tab links
            const tabLinks = document.querySelectorAll('.tab-list a');
            tabLinks.forEach(link => {
                link.addEventListener('click', showTab);
            });
       
            // <!------ tab open page ----->
            //==============================我的資料==================================//
            // $('#mem_name').val(sessionStorage.member_name);           
            if (sessionStorage.member_no) {
                $.ajax({
                    url: "php/getMember.php",
                    type: 'post',
                    dataTyoe: 'json',
                    data: {  //輸入的資料
                        "member_no": sessionStorage.member_no,
                    },
                    success: function (data) {
                        let userData = JSON.parse(data);
                        console.log(userData)
                        $.each(userData[0], function (index, value) {
                            switch (index) {
                                case 'member_id'://帳號
                                    $('#memid').text(value);
                                    break;
                                case 'member_name'://暱稱
                                    $('#mem_name').val(value);
                                    break;
                                case 'member_email'://E-mail
                                    $('#mem_email').val(value);
                                    break;
                                case 'member_tel'://電話
                                    $('#mem_phone').val(value);
                                    break;
                                case 'member_birth'://生日
                                    $('#mem_birth').val(value);
                                    break;
                                case 'member_card_no'://信用卡
                                    $('#mem_credit').val(value);
                                    break;
                                case 'member_money'://購物金
                                    $('#member_money').text(value);
                                    break;

                            }
                            console.log(index)
                        });
                        // console.logo(data);
                    }
                })
            }
        })

        //===============================組隊紀錄=======================================//
        $(function () {
            $.ajax({
                url: "php/getMemberteam.php",
                type: 'post',
                dataTyoe: 'json',
                data: {  //輸入的資料
                    "member_no": sessionStorage.member_no,
                },
                success: function (data) {
                    let userData = JSON.parse(data);
                    console.log(userData)
                    $('.team_body').remove();
                    $.each(userData, function (index, value) {
                        $('.team_list').append(`
                        <div class="team_item">
                            <table>
                                <tr class="team_body">
                                    <td id="team_no">${value.team_no}</td>
                                    <td id="team_name">${value.team_name}</td>
                                    <td id="team_num">${value.team_num}</td>
                                    <td id="team_bounty">${value.team_bounty}</td>
                                </tr>
                               
                            </table> 
                        </div>           
                        `);
                        // switch (index) {
                        //     case 'team_no'://隊伍編號
                        //         $('#team_no').text(value);
                        //         break;
                        //     case 'team_name'://隊伍名稱
                        //         $('#team_name').text(value);
                        //         break;
                        //     case 'team_num'://隊伍人數
                        //         $('#team_num').text(value);
                        //         break;
                        //     case 'team_bounty'://隊伍懸賞金
                        //         $('#team_bounty').text(value);
                        //         break;

                        // }
                        // console.log(index)
                    });
                    // console.logo(data);
                }
            })
        });
        //============================== 留言狀態==================================
        var equ_no = ['', '摩天輪', '旋轉木馬', '海盜船', '滑水道', '旋轉椅', '雲霄飛車'];
        $(function () {
            $.ajax({
                url: "php/getMembermessage.php",
                type: 'post',
                dataTyoe: 'json',
                data: {  //輸入的資料
                    "member_no": sessionStorage.member_no
                },
                success: function (data) {
                    let userData = JSON.parse(data);
                    console.log(userData)
                    $('.message_item').remove();
                    $.each(userData, function (index, value) {
                        $('.message_box').append(` 
                        <div class="message_item">
                            <div class="message_pot">
                                <div class="equ_historypic">
                                    <!-- <img src="" alt="設施照片"> -->
                                    <!-- <span class="equ_ti">設施</span> -->
                                    <span class="equ_no">`+ equ_no[value.equ_no] + `</span>
                                </div>
                                <div class="equ_message">
                                    <p class="equ_message_txt">${value.equ_message}</p>
                                </div>
                            </div>
                        </div>
                        
                        
                        `);
                        //     <div class="message_box">
                        //     <div class="message_item">
                        //         <div class="message_pot">
                        //             <div class="equ_historypic">
                        //                 <!-- <img src="" alt="設施照片"> -->
                        //                 <span>設施</span>
                        //                 <span class="equ_no">`+ equ_no[value.equ_no] + `</span>
                        //             </div>
                        //             <div class="equ_message">
                        //     case 'equ_message'://隊伍名稱
                        //                 <p class="equ_message_txt">${value.equ_message}</p>
                        //             </div>
                        //         </div>
                        //     </div>
                        // </div>


                        // switch (index) {
                        //     case 'equ_no'://隊伍編號
                        //         $('.equ_no').text(value);
                        //         break;
                        //     case 'equ_message'://隊伍名稱
                        //         $('.equ_message_txt').text(value);
                        //         break;
                        // }
                        // console.log(index)
                    });
                    // console.logo(data);
                }
            })
        });
        //====================================門票紀錄===========================================//
        $(function () {
            var entrance_status = ['使用中', '已使用'];
            $.ajax({
                url: "php/getMemberticket.php",
                type: 'post',
                dataTyoe: 'json',
                data: {  //輸入的資料
                    "member_no": sessionStorage.member_no,
                },
                success: function (data) {
                    let userData = JSON.parse(data);
                    console.log(userData)
                    $('.ticket_item').remove();
                    // $('#ticket_list').append('<h3>我的門票</h3>')
                    $.each(userData, function (index, value) {
                        console.log(value)
                        // console.log( '${value.entrance_status}' + "AA")
                        $('#ticket_list').append(`
                             <div class="ticket_item">
                                <p>門票編號:<span class="ticket_no">${value.ticket_no}</span></p>
                                <p>門票狀態:<span class="entrance_status">`+ entrance_status[value.entrance_status] + `</span></p>
                             </div>
                             
                             `)
                    });
                    // console.logo(data);
                }
            })
        });

        // ----------------------------修改資料start------------------------------//
        //1.點擊修改按鈕
        //2.輸入完要更新的資料後，表單會改成更新後的資料
        $('#dit_button').click(function () {
            //將值存起來
            var member_name = $('#mem_name').val();    //暱稱
            var member_email = $('#mem_email').val();  //信箱
            var mem_phone = $('#mem_phone').val();   //電話
            var member_birth = $('#mem_birth').val();  //生日
            var mem_credit = $('#mem_credit').val();  //信用卡 
            $.ajax({
                url: "php/updateMember.php",
                type: 'post',
                dataTyoe: 'json',
                data: {  //輸入的資料
                    "member_no": sessionStorage.member_no,
                    "member_name": member_name,
                    "member_email": member_email,
                    "member_tel": mem_phone,
                    "member_birth": member_birth,
                    "member_card_no": mem_credit,
                },
                success: function (e) {
                    console.log(e);
                    alert("確認更新");
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    alert(jqXHR.responseText);
                },
            });
        });
        //----------------------------修改資料end---------------------------------//        

        //====按了登出按鈕後 會清空 和 跳出頁面=====
        $('.tablink').click(function () {
            window.location.href = "index.html";
            sessionStorage.removeItem('member_no');
           
        })

    </script>
    @@loop('template/jslink.html',[
    ])
</body>

</html>